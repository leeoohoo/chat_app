<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AiChat API å®Œæ•´æµ‹è¯•</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // æ¨¡æ‹Ÿ AiChat ç±»çš„å®Œæ•´å®ç°
        class AiChat {
            constructor(userId, projectId, baseUrl = 'http://localhost:3001/api', className = '') {
                this.userId = userId;
                this.projectId = projectId;
                this.baseUrl = baseUrl;
                this.className = className;
                
                console.log('ğŸ¯ AiChat å®ä¾‹åˆ›å»º:', {
                    userId: this.userId,
                    projectId: this.projectId,
                    baseUrl: this.baseUrl,
                    className: this.className
                });
            }
            
            render() {
                console.log('ğŸ¨ æ¸²æŸ“ AiChat ç»„ä»¶...');
                
                // è¿”å›ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„èŠå¤©ç•Œé¢ç»„ä»¶
                return React.createElement(ChatInterface, {
                    userId: this.userId,
                    projectId: this.projectId,
                    baseUrl: this.baseUrl,
                    className: this.className
                });
            }
            
            getStore() {
                return {
                    userId: this.userId,
                    projectId: this.projectId,
                    baseUrl: this.baseUrl
                };
            }
            
            getApiClient() {
                return {
                    baseUrl: this.baseUrl,
                    get: (url) => console.log(`GET ${this.baseUrl}${url}`),
                    post: (url, data) => console.log(`POST ${this.baseUrl}${url}`, data)
                };
            }
        }
        
        // èŠå¤©ç•Œé¢ç»„ä»¶
        function ChatInterface({ userId, projectId, baseUrl, className }) {
            const [messages, setMessages] = useState([
                {
                    id: '1',
                    role: 'assistant',
                    content: `ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ AiChat åŠ©æ‰‹ã€‚\n\nå½“å‰é…ç½®:\n- ç”¨æˆ·ID: ${userId}\n- é¡¹ç›®ID: ${projectId}\n- APIåœ°å€: ${baseUrl}`,
                    timestamp: new Date()
                }
            ]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);
            
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };
            
            useEffect(() => {
                scrollToBottom();
            }, [messages]);
            
            const handleSendMessage = async () => {
                if (!inputValue.trim()) return;
                
                const userMessage = {
                    id: Date.now().toString(),
                    role: 'user',
                    content: inputValue,
                    timestamp: new Date()
                };
                
                setMessages(prev => [...prev, userMessage]);
                setInputValue('');
                setIsLoading(true);
                
                // æ¨¡æ‹Ÿ API è°ƒç”¨
                setTimeout(() => {
                    const assistantMessage = {
                        id: (Date.now() + 1).toString(),
                        role: 'assistant',
                        content: `æ”¶åˆ°ä½ çš„æ¶ˆæ¯: "${inputValue}"\n\nè¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå›å¤ã€‚åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨ ${baseUrl} çš„ API æ¥è·å– AI å›å¤ã€‚`,
                        timestamp: new Date()
                    };
                    
                    setMessages(prev => [...prev, assistantMessage]);
                    setIsLoading(false);
                }, 1000);
            };
            
            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };
            
            return (
                <div className={`flex flex-col h-full bg-white ${className}`}>
                    {/* å¤´éƒ¨ */}
                    <div className="bg-blue-600 text-white p-4">
                        <h2 className="text-lg font-semibold">ğŸ¤– AiChat ç•Œé¢</h2>
                        <p className="text-sm opacity-90">ç”¨æˆ·: {userId} | é¡¹ç›®: {projectId}</p>
                    </div>
                    
                    {/* æ¶ˆæ¯åˆ—è¡¨ */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {messages.map((message) => (
                            <div
                                key={message.id}
                                className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
                            >
                                <div
                                    className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                                        message.role === 'user'
                                            ? 'bg-blue-600 text-white'
                                            : 'bg-gray-200 text-gray-800'
                                    }`}
                                >
                                    <div className="whitespace-pre-wrap">{message.content}</div>
                                    <div className={`text-xs mt-1 ${
                                        message.role === 'user' ? 'text-blue-100' : 'text-gray-500'
                                    }`}>
                                        {message.timestamp.toLocaleTimeString()}
                                    </div>
                                </div>
                            </div>
                        ))}
                        
                        {isLoading && (
                            <div className="flex justify-start">
                                <div className="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg">
                                    <div className="flex items-center space-x-2">
                                        <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"></div>
                                        <span>æ­£åœ¨æ€è€ƒ...</span>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <div ref={messagesEndRef} />
                    </div>
                    
                    {/* è¾“å…¥åŒºåŸŸ */}
                    <div className="border-t p-4">
                        <div className="flex space-x-2">
                            <textarea
                                value={inputValue}
                                onChange={(e) => setInputValue(e.target.value)}
                                onKeyPress={handleKeyPress}
                                placeholder="è¾“å…¥æ¶ˆæ¯..."
                                className="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                                rows="1"
                                disabled={isLoading}
                            />
                            <button
                                onClick={handleSendMessage}
                                disabled={isLoading || !inputValue.trim()}
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                å‘é€
                            </button>
                        </div>
                    </div>
                </div>
            );
        }
        
        // ä¸»æµ‹è¯•åº”ç”¨
        function TestApp() {
            const [aiChatInstances, setAiChatInstances] = useState([]);
            const [selectedInstance, setSelectedInstance] = useState(null);
            
            useEffect(() => {
                // åˆ›å»ºå¤šä¸ª AiChat å®ä¾‹è¿›è¡Œæµ‹è¯•
                const instances = [
                    {
                        id: 'instance1',
                        name: 'æµ‹è¯•å®ä¾‹ 1',
                        aiChat: new AiChat('user_001', 'project_alpha', 'http://localhost:3001/api', 'border-2 border-blue-500')
                    },
                    {
                        id: 'instance2', 
                        name: 'æµ‹è¯•å®ä¾‹ 2',
                        aiChat: new AiChat('user_002', 'project_beta', 'http://localhost:3002/api', 'border-2 border-green-500')
                    },
                    {
                        id: 'instance3',
                        name: 'æµ‹è¯•å®ä¾‹ 3', 
                        aiChat: new AiChat('user_003', 'project_gamma', 'http://localhost:3003/api', 'border-2 border-purple-500')
                    }
                ];
                
                setAiChatInstances(instances);
                setSelectedInstance(instances[0]);
            }, []);
            
            return (
                <div className="min-h-screen bg-gray-100">
                    <div className="container mx-auto p-4">
                        {/* å¤´éƒ¨ */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <h1 className="text-2xl font-bold text-gray-800 mb-2">
                                ğŸ§ª AiChat API å®Œæ•´æµ‹è¯•
                            </h1>
                            <p className="text-gray-600">
                                æµ‹è¯•é€šè¿‡ <code className="bg-gray-100 px-2 py-1 rounded">new AiChat(user_id, project_id, base_url)</code> åˆ›å»ºå’Œä½¿ç”¨èŠå¤©ç»„ä»¶
                            </p>
                        </div>
                        
                        {/* å®ä¾‹é€‰æ‹©å™¨ */}
                        <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                            <h3 className="text-lg font-semibold mb-3">é€‰æ‹©æµ‹è¯•å®ä¾‹:</h3>
                            <div className="flex space-x-2">
                                {aiChatInstances.map((instance) => (
                                    <button
                                        key={instance.id}
                                        onClick={() => setSelectedInstance(instance)}
                                        className={`px-4 py-2 rounded-lg border ${
                                            selectedInstance?.id === instance.id
                                                ? 'bg-blue-600 text-white border-blue-600'
                                                : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                                        }`}
                                    >
                                        {instance.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                        
                        {/* å®ä¾‹ä¿¡æ¯ */}
                        {selectedInstance && (
                            <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                                <h3 className="text-lg font-semibold mb-3">å½“å‰å®ä¾‹ä¿¡æ¯:</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">ç”¨æˆ·ID</label>
                                        <div className="mt-1 text-sm text-gray-900">{selectedInstance.aiChat.userId}</div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">é¡¹ç›®ID</label>
                                        <div className="mt-1 text-sm text-gray-900">{selectedInstance.aiChat.projectId}</div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">APIåœ°å€</label>
                                        <div className="mt-1 text-sm text-gray-900">{selectedInstance.aiChat.baseUrl}</div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* èŠå¤©ç•Œé¢ */}
                        {selectedInstance && (
                            <div className="bg-white rounded-lg shadow-md overflow-hidden" style={{ height: '600px' }}>
                                {selectedInstance.aiChat.render()}
                            </div>
                        )}
                        
                        {/* API ä½¿ç”¨è¯´æ˜ */}
                        <div className="bg-white rounded-lg shadow-md p-6 mt-6">
                            <h3 className="text-lg font-semibold mb-3">ğŸ“š API ä½¿ç”¨è¯´æ˜</h3>
                            <div className="bg-gray-50 rounded-lg p-4">
                                <pre className="text-sm text-gray-800 overflow-x-auto">
{`// 1. å¯¼å…¥ AiChat ç±»
import { AiChat } from '@your-package/ai-chat';

// 2. åˆ›å»ºå®ä¾‹
const aiChat = new AiChat(
    'user_123',                    // ç”¨æˆ·ID
    'project_456',                 // é¡¹ç›®ID  
    'http://localhost:3001/api',   // APIåŸºç¡€URL (å¯é€‰)
    'custom-class-name'            // CSSç±»å (å¯é€‰)
);

// 3. æ¸²æŸ“ç»„ä»¶
const chatElement = aiChat.render();

// 4. æŒ‚è½½åˆ° React åº”ç”¨
function App() {
    return (
        <div>
            {chatElement}
        </div>
    );
}

// 5. è·å–å®ä¾‹ä¿¡æ¯ (é«˜çº§ç”¨æ³•)
const store = aiChat.getStore();
const apiClient = aiChat.getApiClient();`}
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<TestApp />, document.getElementById('root'));
    </script>
</body>
</html>